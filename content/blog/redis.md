+++
title = "Redis 浅尝辄止"
date = "2026-01-27"
description = ""
draft = true

[taxonomies]
tags = ["redis", "valkey", "nosql"]
+++
> 由于redis在8.0版本变更了开源协议，因此社区分叉出了valkey替代redis，在archlinux上安装redis,会直接安装valkey，redis名称保留并作为valkey的别名。

# 参考资料
- [valkey.io](https://valkey.io/)

# Redis/Valkey
Redis是一个高性能的键值对（Key-Value）内存数据库，同时支持数据持久化、多种数据结构和丰富的扩展功能，常被用于缓存、会话存储、消息队列、实时统计等场景。


## 数据持久化
Redis 支持两种持久化方式，避免内存数据丢失：
- RDB（Redis Database）：定时将内存数据快照写入磁盘，适合备份、灾难恢复。
- AOF（Append Only File）：记录所有写操作命令，重启时重放命令恢复数据，数据安全性更高。
- 也可以同时开启 RDB + AOF，兼顾性能与可靠性。





# 数据类型
Redis 主要支持以下几种数据类型：
- string（字符串）: 基本的数据存储单元，可以存储字符串、整数或者浮点数。最大存储512MB。
- hash（哈希）:一个键值对集合，可以存储多个字段。每个哈希（Hash）最多可以存储 `2^32 - 1` 个键值对。
- list（列表）:一个简单的列表，可以存储一系列的字符串元素，最多可以存储 `2^32 - 1` 个元素。
- set（集合）:一个无序集合，可以存储不重复的字符串元素。
- zset(sorted set：有序集合): 类似于集合，但是每个元素都有一个分数（score）与之关联。
- 位图（Bitmaps）：基于字符串类型，可以对每个位进行操作。
- 超日志（HyperLogLogs）：用于基数统计，可以估算集合中的唯一元素数量。
- 地理空间（Geospatial）：用于存储地理位置信息。
- 发布/订阅（Pub/Sub）：一种消息通信模式，允许客户端订阅消息通道，并接收发布到该通道的消息。
- 流（Streams）：用于消息队列和日志存储，支持消息的持久化和时间排序。
- 模块（Modules）：Redis 支持动态加载模块，可以扩展 Redis 的功能。


## String
`string` 类型是 Redis 最基本的数据类型，可以包含任何数据，比如字符串、jpg图片或者序列化的对象。`string` 类型的值最大能存储 512MB。 

### 常用命令
> Redis 命令关键字对大小写不敏感，在实际开发中，建议将命令关键字大写，而 key/value 等自定义内容小写（或按业务规范）。
```sh
# 设置键的值
SET key value

# 获取键的值
GET key

# 将键的值加1（必须保证键存的是integer,并且没有溢出，不然会返回错误）
# 如果键不存在，从0开始增加（也就是1）
INCR key

# 将键的值减 1
# # 如果键不存在，从0开始减少（也就是-1）
DECR key

# 将值追加到键的值之后(返回值是值占用的大小)
APPEND key value

# 删除键（通用）
DEL key
```

## Hash
键值(key=>value)对集合，是一个 string 类型的 field 和 value 的映射表，适合用于存储对象。每个哈希（Hash）最多可以存储 `2^32 - 1` 个键值对。

### 常用命令
```sh
# 设置哈希表中字段的值（返回值是新增字段的个数，字段重复时会覆盖value）
HSET key field1 value1 [field2 value2 ...]

# 获取哈希表中字段的值
HGET key field

# 获取哈希表中所有字段和值
HGETALL key

# 删除哈希表中的一个或多个字段(返回值是实际成功删除的字段数量)
HDEL key field1 [field2 field3 ...]
```


## List

## Set

## Sorted Set



## Bitmap


## HyperLogLog


## Geospatial Indices


## Pub/Sub


## Stream



## Json



# 最佳实践
- 使用描述性的键名：采用冒号分隔的命名方式为键设置命名空间（例如 user:42:settings）。这种方式便于管理相关联的键，同时避免键名冲突。
- 选择合适的数据类型：按照数据的自然形态进行存储。例如，使用哈希结构将一个对象的所有字段归集在单个键下，而非分散存储为多个独立的键；对于有序的元素集合，则可以使用列表结构。充分利用 Valkey 丰富的数据结构，减少客户端的业务处理逻辑。
- 为易变数据设置过期时间：如果将 Valkey 用作缓存，务必为会话、缓存条目等临时数据对应的键设置生存时间（TTL），避免这些数据长期驻留内存。这一操作可以实现旧数据的自动清理，有效控制内存占用。
- 关注内存限制：默认情况下，Valkey 会持续占用内存，直至达到服务器的内存上限。在生产环境中，若将其作为缓存使用，需要配置 `maxmemory` 内存上限参数，同时搭配合适的淘汰策略（如最近最少使用（LRU）淘汰策略）。这样当内存耗尽时，Valkey 会自动淘汰最久未被使用的缓存条目，而不会直接发生服务故障。
- 按需启用持久化功能：如果需要 Valkey 实现数据的持久化存储（而非仅作为缓存），可以启用持久化配置。Valkey 支持两种持久化方式：生成时间点快照（RDB 文件），或者记录只追加操作日志（AOF），其原理与 Redis 类似。该功能可以在服务重启或发生故障时，保障数据不会丢失。